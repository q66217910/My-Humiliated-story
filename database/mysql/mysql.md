MYSQL
===



### 1.事务

事务是最小的工作单元。一个事务对应着一个完整的业务。

```
事务的特征(ACID):
	原子性: 事务是最小单位，不可再分.
	一致性: 事务的DML语句,必须保证同时成功或者同时失败
	隔离性: 事务之间具有隔离性，事务之间的数据不会相互干扰。
	持久性: 事务一旦提交，对数据库的修改是永久性（内存数据持久化到硬盘中）。
```

##### 1-1. 原子性（undo log）：

```
	InnoDB实现回滚的原理是undo log。当数据库发生修改时,会生成对应的undo log。
	当事务失败或者调用rollback时,便根据undo log中的信息将数据回滚。
```

##### 1-2. 持久性（redo log）：

```
	InnoDB作为MySQL的存储引擎,数据是存储在磁盘中的，为了防止每次读操作都进行io操作，所以有
	缓存(Buffer Pool)，读时先从缓存中读取，没有再读取磁盘加载到缓存。缓存中的数据会定期更新
	到磁盘中(刷脏).缓存虽然加快了读取的速度,减少了IO,但是遇到Mysql宕机就会发生数据丢失。
	
	所以InnoDB使用redo log，先在log记录当前操作,当事务commit时，调用fsync接口对redo log进行刷盘。
	若mysql发生了宕机，重启时读取redo log恢复数据。
	
	redo log是预写式日志，所有修改先写入日志，再更新到缓存。（redo log只包含了要写入磁盘的数据）,
	大大的减少了IO。
	
```

##### 1-3. 隔离性:

​		隔离性要求同一时刻只有一个事务对数据库进行写操作。

```
	事务的隔离级别:
		1.读未提交(RU)：一个事务还未提交，它的变更能被其他事务看见.
		2.读提交(RC): 一个事务提交之后, 它做的变更才会被其他事务看到.
		3.可重复读(RR): 一个事务执行过程中看到的数据, 总是跟这个事务在启动时看到的数据是一致的.
		4.串行化(S): 对于同一行记录, 读写都会加锁. 当出现读写锁冲突的时候, 
		           后访问的事务必须等前一个事务执行完成才能继续执行.
```



### 2. MYSQL的日志

```
	1.binlog(二进制日志)
	2.错误日志
	3.查询日志
	4.慢查询日志
	InnoDB日志：
		1.redo log(重做日志)
		2.undo log(回滚日志) 
```



##### 2-1. undo log(回滚日志) 

```
	undo log记录的是sql执行相关信息。当发生回滚时,执行undo log相反的内容
	例：
		insert->delete
		delete->insert
		update->update回原先的记录
```

##### 2-2. redo log(重做日志)

```
	作用:防止数据库宕机影响持久性
```

##### 2-3. binlog(二进制日志)

```
	作用:可以基于时间点恢复数据,用于主从复制。
```



mysql的组成
---

    连接器：管理连接，权限控制
    分析器：词法分析, 语法分析.
    优化器：执行计划生产，索引的选择。
    执行器： 操作存储引擎, 返回执行结果.